---
  - name: Install packages
    portage:
      package: "{{ item }}"
      state: present
    with_items:
    - www-servers/nginx
    tags:
    - packages

  - name: create dirs for nginx
    file:
      dest: "{{ item }}"
      state: directory
      owner: nginx
    with_items:
      - /etc/nginx/sites
      - /var/log/nginx

  - name: deploy nginx configuration
    template:
      owner: nginx
      group: nginx
      src: etc/nginx/nginx.conf.j2
      dest: /etc/nginx/nginx.conf
      mode: 0644
    notify:
    - restart nginx

  - name: Install nginx daemon service
    template:
      src: etc/systemd/system/nginx-daemon.service.j2
      dest: /etc/systemd/system/nginx-daemon.service
      owner: root
      group: root
      mode: 0644
    notify:
    - systemd daemon reload
    - restart nginx

  - name: Stopping and disabling system nginx service
    service:
      name: nginx
      enabled: no
      state: stopped

  - name: Enabling services
    service:
      name: nginx-daemon
      enabled: yes
