---
  - name: "Создаём каталог для конфигурации [{{ user.name }}]"
    file:
      dest: "/home/{{ user.name }}/{{ item }}"
      state: directory
      owner: "{{ user.name }}"
    become_user: "{{ user.name }}"
    loop:
    - .config/awesome
    - .config/awesome/icons
    - .config/awesome/sounds
    - .config/awesome/autostart
    - .config/awesome/awesome-switcher
    - .config/awesome/cyclefocus
    - .config/awesome/freedesktop
    - wallpapers

  - name: Определяем переменные
    set_fact:
      awesome_home: "/home/{{ user.name }}/.config/awesome"

  - name: "Устанавливаем конфигурацию для [{{ user.name }}]"
    copy:
      src: "home/awesome/{{ item }}.lua"
      dest: "{{ awesome_home }}/{{ item }}.lua"
      mode: 0644
      owner: "{{ user.name }}"
    loop: "{{ awesomewm.code }}"
    become_user: "{{ user.name }}"

  - name: "Устанавливаем переменные для [{{ user.name }}]"
    template:
      src: "home/awesome/{{ item }}.j2.lua"
      dest: "{{ awesome_home }}/{{ item }}.lua"
      mode: 0644
      owner: "{{ user.name }}"
    become_user: "{{ user.name }}"
    loop:
    - defines-global
    - themes/default/theme

  - name: "Устанавливаем хост-зависимые переменные для [{{ user.name }}]"
    template:
      src: "{{ inventory_hostname }}/home/awesome/defines.j2.lua"
      dest: "{{ awesome_home }}/defines.lua"
      mode: 0644
      owner: "{{ user.name }}"
    become_user: "{{ user.name }}"

  - name: Копируем иконки
    synchronize:
      src: "{{ tmp_workdir }}/awesome/fatcow/FatCow_Icons16x16/"
      dest: "{{ awesome_home }}/icons/FatCow"
      delete: yes
      recursive: yes
      owner: no
    become_user: "{{ user.name }}"

  - name: Копируем тему
    synchronize:
      src: files/home/awesome/themes
      dest: "{{ awesome_home }}"
      recursive: yes
      owner: no
    become_user: "{{ user.name }}"

  - name: Клонируем внешние плагины
    git:
      repo: "{{ item.repo }}"
      dest: "{{ awesome_home }}/{{ item.dest }}"
    loop:
    - { repo: "https://github.com/warptozero/awesome-autostart", dest: autostart }
    - { repo: "https://github.com/berlam/awesome-switcher", dest: awesome-switcher }
    - { repo: "https://github.com/blueyed/awesome-cyclefocus", dest: cyclefocus }
    - { repo: "https://github.com/lcpz/awesome-freedesktop", dest: freedesktop }
    become_user: "{{ user.name }}"

  - name: Устанавливаем тему GTK и иксов
    template:
      src: "templates/{{ item.src }}"
      dest: "/home/{{ user.name }}/{{ item.dest }}"
      mode: 0644
      owner: "{{ user.name }}"
    become_user: "{{ user.name }}"
    loop:
    - { src: home/gtk-3.0/settings.ini.j2, dest: .config/gtk-3.0/settings.ini }
    - { src: home/gtkrc-2.0.j2, dest: .gtkrc-2.0 }
    - { src: home/Xresources.j2, dest: .Xresources }

  - name: Устанавливаем тему Qt
    ini_file:
      path: "/home/{{ user.name }}/.config/qt5ct/qt5ct.conf"
      section: "{{ item.section }}"
      option: "{{ item.key }}"
      value: "{{ item.value }}"
    loop:
    - { section: Appearance, key: style, value: "{{ merged_vars.X.theme.name }}" }
    - { section: Appearance, key: icon_theme, value: "{{ merged_vars.X.icons.name }}" }
    - { section: Appearance, key: custom_palette, value: "false" }
    - { section: Appearance, key: standard_dialogs, value: defaults }
    - { section: Interface, key: menus_have_icons, value: "true" }
    - { section: Interface, key: dialog_buttons_have_icons, value: 2 }
